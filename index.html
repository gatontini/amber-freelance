<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amber - Il Tuo Assistente Virtuale</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
            padding: 20px;
            box-sizing: border-box;
        }
        #chat-container {
            width: 100%;
            max-width: 600px;
            padding: 0;
height: 90vh; /* Altezza simile a quella di una chat */
display: flex;
flex-direction: column;

            background-color: white;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            border-radius: 8px;
        }
        #messages {
            flex: 1;
background-color: #e5ddd5; /* Sfondo simile a WhatsApp */

            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
.message {
    margin-bottom: 15px;
    padding: 10px 15px;
    border-radius: 20px;
    max-width: 80%;
    position: relative;
    animation: fadeIn 0.5s ease-out;
}
        .message .time {
    display: block;
    font-size: 12px;
    color: #999;
    margin-top: 5px;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

        .message.user {
            text-align: right;
background-color: #dcf8c6; /* Verde chiaro per l'utente */
margin-left: auto;
text-align: right;

        }
        .message.bot {
            text-align: left;
background-color: #fff;
margin-right: auto;
text-align: left;
border: 1px solid #ccc;

            white-space: pre-wrap;
            word-wrap: break-word;
        }
        #user-input {
            display: flex;
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        #userMessage {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #sendButton {
            padding: 10px 20px;
            border: none;
            background-color: #000;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            margin-left: 10px;
        }
        #sendButton:hover {
            background-color: #333;
        }
    </style>
</head>
<body>
    <div id="chat-container">
        <div id="messages"></div>
        <div id="user-input">
            <input type="text" id="userMessage" placeholder="Scrivi qui il tuo messaggio...">
            <button id="sendButton">Invia</button>
        </div>
    </div>

    <script>
let conversationHistory = "";  // Variabile per mantenere il contesto della conversazione

const messagesContainer = document.getElementById('messages');

document.getElementById('sendButton').addEventListener('click', sendMessage);
document.getElementById('userMessage').addEventListener('keypress', function (e) {
    if (e.key === 'Enter') {
        sendMessage();
    }
});

async function sendMessage() {
    const userMessage = document.getElementById('userMessage').value;
    if (!userMessage) return;

    // Aggiungi il messaggio dell'utente alla cronologia della conversazione
    conversationHistory += `User: ${userMessage}\n`;

    // Visualizza il messaggio dell'utente nella chat
    const userMessageElement = document.createElement('div');
    userMessageElement.className = 'message user';
    userMessageElement.textContent = 'Tu: ' + userMessage;
    messagesContainer.appendChild(userMessageElement);

    // Svuota il campo di input
    document.getElementById('userMessage').value = '';

    const prompt = `
    Sei Amber, un'assistente virtuale che aiuta liberi professionisti e studi con compiti quotidiani legati alla scrittura di testi. Il tuo ruolo è di assistere nella creazione di contenuti come email, articoli di blog, post sui social media, e qualsiasi altro tipo di testo richiesto. Rispondi in modo professionale e accurato, assicurandoti che i testi siano ben strutturati, chiari e adatti al contesto. Comunica esclusivamente in italiano.

Se vengono richieste informazioni personali o non inerenti al supporto professionale, come argomenti legati a politica, religione, o animali, spiega che i tuoi orientamenti riflettono quelli dei creatori di Amber: siamo apolitici, crediamo nel Dio cristiano, ma siamo assolutamente rispettosi di ogni religione. Amiamo gli animali e rispettiamo ogni forma di vita.

In tutti gli altri casi, rispondi che non sei preparata a rispondere a domande che esulano il tuo ruolo di assistente personale e chiedi gentilmente di poter essere utile per ciò per cui sei stata formata.


    Conversation so far:
    ${conversationHistory}
    Amber:`;

    try {
        const response = await fetch('/.netlify/functions/amber', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: prompt })
        });

        const data = await response.json();

        let botMessage = data.message;

        // Aggiungi il messaggio di Amber alla cronologia della conversazione
        conversationHistory += `Amber: ${botMessage}\n`;

        // Visualizza il messaggio di Amber nella chat
        const botMessageElement = document.createElement('div');
        botMessageElement.className = 'message bot';
        botMessageElement.innerHTML = 'Amber: ' + botMessage.replace(/\n/g, '<br>');
        messagesContainer.appendChild(botMessageElement);

        // Scorri fino in fondo alla chat
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    } catch (error) {
        console.error('Errore nella comunicazione con Amber:', error);
        const botMessageElement = document.createElement('div');
        botMessageElement.className = 'message bot';
        botMessageElement.innerHTML = 'Amber: Mi dispiace, c\'è stato un problema nel rispondere alla tua richiesta.';
        messagesContainer.appendChild(botMessageElement);
    }
}

    </script>
</body>
</html>
